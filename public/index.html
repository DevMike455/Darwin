<!DOCTYPE html>
<html lang="fr" ng-app="darwin">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Darwin</title>

    <!-- Bootstrap core CSS -->
    <link href="static/css/bootstrap.css" rel="stylesheet">
    <style rel="stylesheet">
    	[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
			display: none !important;
		}
		.loader {position: absolute; top: 50%; left: 50%; z-index: -1; margin: -16px 0 0 -16px;}
		.content_loaded { background: #FFF;}
    </style>

    <!-- Custom styles for this template -->
    <link href="static/css/starter-template.css" rel="stylesheet">
    <link href="static/css/responsive-calendar.css" rel="stylesheet" media="screen">
  </head>

  <body ng-controller="mainController">
  	<div class="content_loaded" ng-cloak>
	    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	      <div class="container">
	        <div class="navbar-header">
	          <a class="navbar-brand" href="#" ng-click="gotopage('calendar')">DARWIN - HardWin</a>
	          <ul class="nav navbar-nav">
	            <li><a href="#" ng-click="gotopage('calendar')"><span class="glyphicon glyphicon-home"></span> Accueil</a></li>
	          </ul>
	        </div><!--/.nav-collapse -->
	        <div class="pull-right">
				<button type="button" class="btn btn-default navbar-btn" ng-if="curr_page != 'calendar'" ng-click="sync()"><span class="glyphicon glyphicon-refresh"></span> Sync</button>
			    <button type="button" class="btn btn-default navbar-btn" ng-if="loggedIn > 1" data-toggle="modal" data-target="#adduser"><span class="glyphicon glyphicon-user"></span> Ajouter utilisateur</button>
			    <button type="button" class="btn btn-default navbar-btn" ng-click="logout()"><span class="glyphicon glyphicon-log-out"></span> Se déconnecter</button>
		    </div>
	      </div>
	    </div>
		<div ng-if="errors" class="alter alert-danger container"><p>{{ errors }}</p></div>
		<div ng-if="message" class="alter alert-success container"><p>{{ message }}</p></div>
		<div ng-switch="curr_page">
		    <div id ="calendar" class="container" ng-show="curr_page == 'calendar'">
				<div class="starter-template">
					<h1>Calendrier</h1>
					<!-- Responsive calendar - START -->
			    	<div class="responsive-calendar">
			        <div class="controls">
			            <a class="pull-left" data-go="prev"><div class="btn btn-primary">Prev</div></a>
			            <h4><span data-head-year></span> <span data-head-month></span></h4>
			            <a class="pull-right" data-go="next"><div class="btn btn-primary">Next</div></a>
			        </div><hr/>
			        <div class="day-headers">
			          <div class="day header">Mon</div>
			          <div class="day header">Tue</div>
			          <div class="day header">Wed</div>
			          <div class="day header">Thu</div>
			          <div class="day header">Fri</div>
			          <div class="day header">Sat</div>
			          <div class="day header">Sun</div>
			        </div>
			        <div class="days" data-group="days">
			          
			        </div>
			      </div>
			      <!-- Responsive calendar - END -->
				</div>
		    </div><!-- container -->
		    
		    <div id="todo-list" class="container" ng-switch-when="list">
			    <div class="col-sm-4 col-sm-offset-4">
			        <div ng-repeat="user in users">
			            <label>
			                <a href="#" ng-click="getUser(user.id)">{{ user.doc.lastname }}, {{ user.doc.firstname }}</a>
			            </label>
			        </div>
			    </div>
			</div>
		
		    <div id="profile" class="container" ng-switch-when="user">
		    	{{ update_message }}
		        <div classe="row" align="center">
		          <h1>Profil</h1>
		        </div>
		        <div class="row">
		          <div class="col-sm-4" align="center">
		            <h2>Informations</h2>
		            <div ng-if="user_img">
		            	<img src="{{ user_img }}" alt="" />
		            </div>
		            <div ng-if="!user_img">
			            <img ng-show="btn.orig" src="http://illiweb.com/fa/i/avatars/gallery/Animaux/Chaton_a_oeil.gif" id="photo_default" class="img-responsive img-circle center-block" />
			            <video id="video" width="250" height="150" ng-show="!btn.orig" autoplay class="center-block"></video>
						<canvas id="canvas" width="250" height="150" class="center-block" style="position: absolute; top: 63px; left: 95px; z-index: -1;">
						</canvas>
			            <button type="button" ng-click="snap()" ng-show="!btn.video" class="btn btn-default center-block">Prendre une photo</button>
			            <button ng-click="take_photo()" ng-show="btn.video" class="btn btn-default center-block">Snap Photo</button>
		            </div>
		            <h4>{{ user_info.civ }}.{{ user_info.lastname }} {{ user_info.firstname}}</h4>
		            <h5>ID : {{ user_info._id}} </h5>
		            <p>{{ user_info.birthdate }}</p>
		            <p>{{ user_info.cursus }}</p>
		            <a href="mailto:{{ user_info.emai}}">{{ user_info.mail}}</a>
		          </div> <!-- col-sm-4 -->
		          <div class="col-sm-8" align="center">
		            <h2>Évaluation</h2>
		            <div class="row">
		              <div class="col-sm-4" align="center">
		                <div class="alert" role="alert" ng-repeat="(key, val) in user_info.ex" ng-class="get_ex_class(val)">
		                	<button ng-click="validateEx(key, $event)" type="button" class="btn btn-default btn-xs pull-left">
		                		<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
		            		</button>
		            		<span ng-click="reinitEx(key, $event)">exercice {{ key }} </span>
		            		<button ng-click="refuseEx(key, $event)" type="button" class="btn btn-default btn-xs pull-right">
		            			<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
		        			</button>
		    			</div>
		              </div> <!-- col-sm-2 -->
		              <div class="col-sm-8" align="center">
		                <div class="input-group center-block">
		                	<form ng-submit="addComment(user_info._rev, user_info._id)">
			                  <div class="input-group">
			                    <input type="text" class="form-control" value="{{ f_user.comment }}" placeholder="Message" ng-model="f_user.comment" />
			                    <span class="input-group-btn ">
			                      	<button class="btn btn-default" type="button"><span class="glyphicon glyphicon-send"></span></button>
			                    </span>
		                  	</div><!-- /input-group -->
		                  </form>
		                  <li ng-repeat="(date, comment) in user_info.comments">
		             		<p>
		             			{{ comment }}<br />
		             			<small>{{ date | date:'yyyy-MM-dd HH:mm:ss'}}</small>
		         			</p>
			             </li>
		                </div> <!-- col-sm-6 -->
		              </div> <!-- row -->
		            </div> <!-- input-group center-block -->
		          </div> <!-- col-sm-4 -->
		        </div> <!-- row info + eval -->
		        <div classe="row" align="center">
		          <h2>Commentaire final</h2>
		          <div class="input-group center-block">
		            <div class="input-group">
		              <input type="text" class="form-control" placeholder="Message">
		              <span class="input-group-btn">
		                <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-send"></span></button>
		              </span>
		            </div><!-- /input-group -->
		          </div> <!-- input-group center-block -->
		        </div>
		    </div><!-- profile -->
		</div>
	   
	   	<div class="modal fade" id="login">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" align="center">Identification</h4>
					</div>
					<div class="modal-body form-group">
						<div ng-if="errors_login" class="alert alert-danger" role="alert"><p>{{ errors_login }}</p></div>
					 	<input type="text" class="form-control log" placeholder="Identifiant" ng-value="login.login" ng-model="login_form.login" />
						<input type="password" class="form-control log" placeholder="Mot de passe" ng-value="login.pwd" ng-model="login_form.pwd" />
					</div>
					<div class="modal-footer">
					<button ng-click="login()" type="button" class="btn btn-primary">Connexion</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal login -->
		
		<div class="modal fade" id="adduser">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title" align="center">Ajouter un utilisateur</h4>
					</div>
					<div class="modal-body form-group">
						<div ng-if="new_user.error" class="alert alert-danger" role="alert"><p>{{ new_user.error }}</p></div>
						<div ng-if="new_user.success" class="alert alert-success" role="alert"><p>{{ new_user.success }}</p></div>
					 	<input type="text" class="form-control log" placeholder="Identifiant" ng-model="new_user.login" />
						<input type="password" class="form-control log" placeholder="Mot de passe" ng-model="new_user.pwd"/>
						<select name="selectList" class="form-control log" ng-model="new_user.accred">
							<option value="1">Évaluateur</option> 
							<option value="2">Administrateur</option> 
						</select> 
					</div>
					<div class="modal-footer">
					<button ng-click="create_user()" type="button" class="btn btn-primary">Valider</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal adduser-->
		
		<div class="modal fade" id="import_csv">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title" align="center">Importation du CSV</h4>
					</div>
					<div class="modal-body form-group" align="center">
						<div ng-if="csv.error" class="alert alert-danger" role="alert"><p> {{ csv.error }} </p></div>
						<form method="post" enctype="multipart/form-data">
							<p><input file-input="file" type="file" name="csv" /></p>
							<p><input id="date_csv" type="hidden" name="csv" value="0" /></p>
							<p>Aucun CSV détecté pour cette journée, veuillez en importer un.</p>
							<button ng-click="csv_upload($event)" class="btn btn-default">Envoyer <span class="glyphicon glyphicon-import" aria-hidden="true"></span></button>
							<span class="glyphicon glyphicon-saved" aria-hidden="true"></span>
						</form>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal import_csv -->
		
		<div class="modal fade" id="day_view">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<div ng-if="admin.error" class="alert alert-danger" role="alert"><p> {{ admin.error }} </p></div>
						<h4 class="modal-title" align="center">descriptif de la journée</h4>
					</div>
					<div class="modal-body form-group" align="center">
						<p><input id="date_csv_show" type="hidden" name="csv" value="0" /></p>
						<button ng-click="show_events()" class="btn btn-default" data-dismiss="modal">Acceder à la journée <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button><br /><br />
						<button ng-click="remove_events()" class="btn btn-default" ng-if="loggedIn > 1" data-dismiss="modal">Supprimer les datas <span class="glyphicon glyphicon-floppy-remove" aria-hidden="true"></span></button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal import_csv -->
	
		<div id="footer" class="text-center"><p>© 2009-2014 ETNA SARL. All rights reserved.</p></div>
	</div>
	<div class="loader">
		<img src="static/img/loading.gif" alt="loading" />
	</div>
	<div class="run_stream"></div>
    <script type="text/javascript" src="static/js/jquery.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.js"> </script>
    <script src="http://code.angularjs.org/1.2.27/angular.js"></script>
    <script type="text/javascript" src="static/js/responsive-calendar.min.js"></script>
	<script src="static/js/pouchdb-3.1.0.min.js"></script>
	<script src="static/js/core.js"></script>
    <script type="text/javascript">
	    jQuery(function($){
	    	$(".responsive-calendar").responsiveCalendar({
				onDayClick: function(e) { 
					$this = $(this);
					var day = ($this.attr('data-day') < 10) ? "0" + $this.attr('data-day') : $this.attr('data-day');
					var month = ($this.attr('data-month') < 10) ? "0" + $this.attr('data-month') : $this.attr('data-month');
					var date = $this.attr('data-year') + "-" + month + "-" + day;
					if ($this.parent().hasClass('active'))
					{
						$("#day_view").modal("show");
						$("#day_view").find("input#date_csv_show").val(date);
					}else
					{
						$("#import_csv").find("input#date_csv").val(date);
						$("#import_csv").modal("show");
					}
				}
			});
	    });
    </script>
  </body>
</html>